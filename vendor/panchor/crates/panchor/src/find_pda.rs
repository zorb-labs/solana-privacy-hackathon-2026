//! PDA traits for finding program addresses and generating signer seeds.
//!
//! This module provides the `FindProgramAddress` trait that is implemented
//! by PDA enums generated by the `#[pdas]` attribute macro.

use pinocchio::pubkey::Pubkey;

/// Trait for PDA enums that can find their program address.
///
/// This trait is automatically implemented by the `#[pdas]` attribute macro
/// on PDA enums.
pub trait FindProgramAddress {
    /// Find the program address and bump for this PDA variant.
    ///
    /// Returns a tuple of (address, `bump_seed`).
    fn find_program_address(&self, program_id: &Pubkey) -> (Pubkey, u8);
}

/// A wrapper for signer seeds that can be converted to a Signer.
///
/// This struct holds an array of `Seed` values that can be passed to
/// `invoke_signed`.
#[derive(Clone)]
pub struct SignerSeeds<'a, const N: usize> {
    seeds: [pinocchio::instruction::Seed<'a>; N],
}

impl<'a, const N: usize> SignerSeeds<'a, N> {
    /// Create a new `SignerSeeds` from an array of seeds.
    #[inline]
    pub const fn new(seeds: [pinocchio::instruction::Seed<'a>; N]) -> Self {
        Self { seeds }
    }

    /// Get the seeds as a slice.
    #[inline]
    pub fn as_slice(&self) -> &[pinocchio::instruction::Seed<'a>] {
        &self.seeds
    }
}

impl<'a, const N: usize> AsRef<[pinocchio::instruction::Seed<'a>]> for SignerSeeds<'a, N> {
    #[inline]
    fn as_ref(&self) -> &[pinocchio::instruction::Seed<'a>] {
        &self.seeds
    }
}

impl<'a, 'b, const N: usize> From<&'b SignerSeeds<'a, N>>
    for pinocchio::instruction::Signer<'a, 'b>
{
    #[inline]
    fn from(seeds: &'b SignerSeeds<'a, N>) -> Self {
        pinocchio::instruction::Signer::from(&seeds.seeds)
    }
}
